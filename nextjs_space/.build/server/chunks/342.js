"use strict";exports.id=342,exports.ids=[342],exports.modules={64046:(e,t)=>{function i(e){return{enumerable:!0,value:e}}function r(e){return{enumerable:!0,writable:!0,value:e}}Object.defineProperty(t,"__esModule",{value:!0});let n={},s=()=>!0,o=()=>({}),a=e=>e,l=(e,t,i,r)=>e.apply(i,r)&&t.apply(i,r),c=(e,t,i,[r,n])=>t.call(i,e.call(i,r,n),n),h=(e,t)=>Object.freeze(Object.create(e,t));function u(e,t,i){return e.reduce((e,t)=>function(...r){return i(e,t,this,r)},t)}function d(e){return h(this,{fn:i(e)})}let f={},p=d.bind(f),y={},g=d.bind(y);function m(e,t){return t.filter(t=>e.isPrototypeOf(t))}function w(e,t,...r){let n=u(m(y,r).map(e=>e.fn),s,l),o=u(m(f,r).map(e=>e.fn),a,c);return h(this,{from:i(e),to:i(t),guards:i(n),reducers:i(o)})}let b={},v={},U=w.bind(b),E=w.bind(v,null);function x(e,t,i){return I(t,e,i,this.immediates)||e}function S(e){let t=new Map;for(let i of e)t.has(i.from)||t.set(i.from,[]),t.get(i.from).push(i);return t}let O={enter:a},_={enter(e,t,r){let n=this.fn.call(t,t.context,r);return T.isPrototypeOf(n)?h(A,{machine:i(n),transitions:i(this.transitions)}).enter(e,t,r):(n.then(e=>t.send({type:"done",data:e})).catch(e=>t.send({type:"error",error:e})),e)}},A={enter(e,t,i){if(t.child=P(this.machine,e=>{t.onChange(e),t.child==e&&e.machine.state.value.final&&(delete t.child,t.send({type:"done",data:e.context}))},t.context,i),t.child.machine.state.value.final){let i=t.child.context;return delete t.child,I(t,e,{type:"done",data:i},this.transitions.get("done"))}return e}},T={get state(){return{name:this.current,value:this.states[this.current]}}};function I(e,t,r,s){let{context:o}=e;for(let{to:a,guards:l,reducers:c}of s)if(l(o,r)){e.context=c.call(e,o,r);let s=t.original||t,l=h(s,{current:i(a),original:{value:s}});return n._onEnter&&n._onEnter(t,a,e.context,o,r),l.state.value.enter(l,e,r)}}let j={send(e){this.machine=function(e,t){let i=t.type||t,{machine:r}=e,{value:s,name:o}=r.state;return s.transitions.has(i)?I(e,r,t,s.transitions.get(i))||r:(n._send&&n._send(i,o),r)}(this,e),this.onChange(this)}};function P(e,t,n,s){let o=Object.create(j,{machine:r(e),context:r(e.context(n,s)),onChange:i(t)});return o.send=o.send.bind(o),o.machine=o.machine.state.value.enter(o.machine,o,s),o}t.action=e=>p((t,i)=>!!~e(t,i)&&t),t.createMachine=function(e,t,r=o){return"string"!=typeof e&&(r=t||o,e=Object.keys(t=e)[0]),n._create&&n._create(e,t),h(T,{context:i(r),current:i(e),states:i(t)})},t.d=n,t.guard=g,t.immediate=E,t.interpret=P,t.invoke=function(e,...t){let r=i(S(t));return T.isPrototypeOf(e)?h(A,{machine:i(e),transitions:r}):h(_,{fn:i(e),transitions:r})},t.reduce=p,t.state=function(...e){let t=m(b,e),r=m(v,e),n={final:i(0===e.length),transitions:i(S(t))};return r.length&&(n.immediates=i(r),n.enter=i(x)),h(O,n)},t.transition=U},80093:function(e,t,i){var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(n,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(o,a)}l((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.TOKEN_EXPIRATION_SECONDS=void 0,t.getTemporaryAuthToken=function(e,i){return r(this,void 0,void 0,function*(){let r=(0,o.parseEndpointId)(e),a=yield(0,s.dispatchRequest)({method:"POST",targetUrl:`${(0,n.getRestApiUrl)()}/tokens/`,config:i,input:{allowed_apps:[r.alias],token_expiration:t.TOKEN_EXPIRATION_SECONDS}});return"string"!=typeof a&&a.detail?a.detail:a})};let n=i(61254),s=i(89474),o=i(90665);t.TOKEN_EXPIRATION_SECONDS=120},96761:function(e,t,i){var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(n,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(o,a)}l((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.createFalClient=function(e={}){let t=(0,n.createConfig)(e),i=(0,c.createStorageClient)({config:t}),u=(0,s.createQueueClient)({config:t,storage:i}),d=(0,h.createStreamingClient)({config:t,storage:i});return{queue:u,realtime:(0,o.createRealtimeClient)({config:t}),storage:i,streaming:d,stream:d.stream,run(e){return r(this,arguments,void 0,function*(e,r={}){let n=r.input?yield i.transformInput(r.input):void 0;return(0,a.dispatchRequest)({method:r.method,targetUrl:(0,a.buildUrl)(e,r),input:n,config:Object.assign(Object.assign({},t),{responseHandler:l.resultResponseHandler}),options:{signal:r.abortSignal,retry:{maxRetries:3,baseDelay:500,maxDelay:15e3}}})})},subscribe:(e,t)=>r(this,void 0,void 0,function*(){let{request_id:i}=yield u.submit(e,t);return t.onEnqueue&&t.onEnqueue(i),yield u.subscribeToStatus(e,Object.assign({requestId:i},t)),u.result(e,{requestId:i})})}};let n=i(61254),s=i(56873),o=i(79778),a=i(89474),l=i(66506),c=i(36772),h=i(74021)},61254:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.credentialsFromEnv=void 0,t.resolveDefaultFetch=a,t.createConfig=function(e){var t;let i=Object.assign(Object.assign(Object.assign({},l),e),{fetch:null!==(t=e.fetch)&&void 0!==t?t:a(),retry:Object.assign(Object.assign({},s.DEFAULT_RETRY_OPTIONS),e.retry||{})});e.proxyUrl&&(i=Object.assign(Object.assign({},i),{requestMiddleware:(0,r.withMiddleware)(i.requestMiddleware,(0,r.withProxy)({targetUrl:e.proxyUrl}))}));let{credentials:n,suppressLocalCredentialsWarning:c}=i,h="function"==typeof n?n():n;return(0,o.isBrowser)()&&h&&!c&&console.warn("The fal credentials are exposed in the browser's environment. That's not recommended for production use cases."),i},t.getRestApiUrl=function(){return"https://rest.alpha.fal.ai"};let r=i(26087),n=i(66506),s=i(88131),o=i(74211);function a(){if("undefined"==typeof fetch)throw Error("Your environment does not support fetch. Please provide your own fetch implementation.");return fetch}t.credentialsFromEnv=()=>"undefined"!=typeof process&&process.env&&(void 0!==process.env.FAL_KEY||void 0!==process.env.FAL_KEY_ID&&void 0!==process.env.FAL_KEY_SECRET)?void 0!==process.env.FAL_KEY?process.env.FAL_KEY:process.env.FAL_KEY_ID?`${process.env.FAL_KEY_ID}:${process.env.FAL_KEY_SECRET}`:void 0:void 0;let l={credentials:t.credentialsFromEnv,suppressLocalCredentialsWarning:!1,requestMiddleware:e=>Promise.resolve(e),responseHandler:n.defaultResponseHandler,retry:s.DEFAULT_RETRY_OPTIONS}},95342:function(e,t,i){let r;var n=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i);var n=Object.getOwnPropertyDescriptor(t,i);(!n||("get"in n?!t.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,r,n)}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),s=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),t.fal=t.parseEndpointId=t.isRetryableError=t.ValidationError=t.ApiError=t.withProxy=t.withMiddleware=t.createFalClient=void 0;let o=i(96761);var a=i(96761);Object.defineProperty(t,"createFalClient",{enumerable:!0,get:function(){return a.createFalClient}});var l=i(26087);Object.defineProperty(t,"withMiddleware",{enumerable:!0,get:function(){return l.withMiddleware}}),Object.defineProperty(t,"withProxy",{enumerable:!0,get:function(){return l.withProxy}});var c=i(66506);Object.defineProperty(t,"ApiError",{enumerable:!0,get:function(){return c.ApiError}}),Object.defineProperty(t,"ValidationError",{enumerable:!0,get:function(){return c.ValidationError}});var h=i(88131);Object.defineProperty(t,"isRetryableError",{enumerable:!0,get:function(){return h.isRetryableError}}),s(i(54539),t);var u=i(90665);Object.defineProperty(t,"parseEndpointId",{enumerable:!0,get:function(){return u.parseEndpointId}}),t.fal=(r=(0,o.createFalClient)(),{config(e){r=(0,o.createFalClient)(e)},get queue(){return r.queue},get realtime(){return r.realtime},get storage(){return r.storage},get streaming(){return r.streaming},run:(e,t)=>r.run(e,t),subscribe:(e,t)=>r.subscribe(e,t),stream:(e,t)=>r.stream(e,t)})},26087:function(e,t){var i=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(n,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(o,a)}l((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.TARGET_URL_HEADER=void 0,t.withMiddleware=function(...e){let t=e=>"function"==typeof e;return r=>i(this,void 0,void 0,function*(){let i=Object.assign({},r);for(let r of e.filter(t))i=yield r(i);return i})},t.withProxy=function(e){let i=e=>Promise.resolve(e);return"undefined"==typeof window?i:r=>r.headers&&t.TARGET_URL_HEADER in r?i(r):Promise.resolve(Object.assign(Object.assign({},r),{url:e.targetUrl,headers:Object.assign(Object.assign({},r.headers||{}),{[t.TARGET_URL_HEADER]:r.url})}))},t.TARGET_URL_HEADER="x-fal-target-url"},56873:function(e,t,i){var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(n,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(o,a)}l((r=r.apply(e,t||[])).next())})},n=this&&this.__rest||function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,r=Object.getOwnPropertySymbols(e);n<r.length;n++)0>t.indexOf(r[n])&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(i[r[n]]=e[r[n]]);return i};Object.defineProperty(t,"__esModule",{value:!0}),t.createQueueClient=void 0;let s=i(89474),o=i(66506),a=i(88131),l=i(74021),c=i(90665),h={maxRetries:3,baseDelay:1e3,maxDelay:6e4,retryableStatusCodes:a.DEFAULT_RETRYABLE_STATUS_CODES},u={maxRetries:5,baseDelay:1e3,maxDelay:3e4,retryableStatusCodes:[...a.DEFAULT_RETRYABLE_STATUS_CODES,500]};t.createQueueClient=({config:e,storage:t})=>{let i={submit(i,o){return r(this,void 0,void 0,function*(){let{webhookUrl:r,priority:a,hint:l}=o,c=n(o,["webhookUrl","priority","hint"]),u=o.input?yield t.transformInput(o.input):void 0;return(0,s.dispatchRequest)({method:o.method,targetUrl:(0,s.buildUrl)(i,Object.assign(Object.assign({},c),{subdomain:"queue",query:r?{fal_webhook:r}:void 0})),headers:Object.assign({"x-fal-queue-priority":null!=a?a:"normal"},l&&{"x-fal-runner-hint":l}),input:u,config:e,options:{signal:o.abortSignal,retry:h}})})},status(t,i){return r(this,arguments,void 0,function*(t,{requestId:i,logs:r=!1,abortSignal:n}){let o=(0,c.parseEndpointId)(t),a=o.namespace?`${o.namespace}/`:"";return(0,s.dispatchRequest)({method:"get",targetUrl:(0,s.buildUrl)(`${a}${o.owner}/${o.alias}`,{subdomain:"queue",query:{logs:r?"1":"0"},path:`/requests/${i}/status`}),config:e,options:{signal:n,retry:u}})})},streamStatus(t,i){return r(this,arguments,void 0,function*(t,{requestId:i,logs:r=!1,connectionMode:n}){let o=(0,c.parseEndpointId)(t),a=o.namespace?`${o.namespace}/`:"",h={logs:r?"1":"0"},u=(0,s.buildUrl)(`${a}${o.owner}/${o.alias}`,{subdomain:"queue",path:`/requests/${i}/status/stream`,query:h});return new l.FalStream(t,e,{url:u,method:"get",connectionMode:n,queryParams:h})})},subscribeToStatus(e,t){return r(this,void 0,void 0,function*(){let n;let s=t.requestId,o=t.timeout,a=()=>{};if("streaming"===t.mode){let r=yield i.streamStatus(e,{requestId:s,logs:t.logs,connectionMode:"connectionMode"in t?t.connectionMode:void 0}),l=[];o&&(n=setTimeout(()=>{throw r.abort(),i.cancel(e,{requestId:s}).catch(a),Error(`Client timed out waiting for the request to complete after ${o}ms`)},o)),r.on("data",e=>{t.onQueueUpdate&&("logs"in e&&Array.isArray(e.logs)&&e.logs.length>0&&l.push(...e.logs),t.onQueueUpdate("logs"in e?Object.assign(Object.assign({},e),{logs:l}):e))});let c=yield r.done();return n&&clearTimeout(n),c}return new Promise((l,c)=>{var h;let u;let d="pollInterval"in t&&"number"==typeof t.pollInterval&&null!==(h=t.pollInterval)&&void 0!==h?h:500,f=()=>{n&&clearTimeout(n),u&&clearTimeout(u)};o&&(n=setTimeout(()=>{f(),i.cancel(e,{requestId:s}).catch(a),c(Error(`Client timed out waiting for the request to complete after ${o}ms`))},o));let p=()=>r(this,void 0,void 0,function*(){var r;try{let n=yield i.status(e,{requestId:s,logs:null!==(r=t.logs)&&void 0!==r&&r,abortSignal:t.abortSignal});if(t.onQueueUpdate&&t.onQueueUpdate(n),"COMPLETED"===n.status){f(),l(n);return}u=setTimeout(p,d)}catch(e){f(),c(e)}});p().catch(c)})})},result(t,i){return r(this,arguments,void 0,function*(t,{requestId:i,abortSignal:r}){let n=(0,c.parseEndpointId)(t),a=n.namespace?`${n.namespace}/`:"";return(0,s.dispatchRequest)({method:"get",targetUrl:(0,s.buildUrl)(`${a}${n.owner}/${n.alias}`,{subdomain:"queue",path:`/requests/${i}`}),config:Object.assign(Object.assign({},e),{responseHandler:o.resultResponseHandler}),options:{signal:r,retry:h}})})},cancel(t,i){return r(this,arguments,void 0,function*(t,{requestId:i,abortSignal:r}){let n=(0,c.parseEndpointId)(t),o=n.namespace?`${n.namespace}/`:"";yield(0,s.dispatchRequest)({method:"put",targetUrl:(0,s.buildUrl)(`${o}${n.owner}/${n.alias}`,{subdomain:"queue",path:`/requests/${i}/cancel`}),config:e,options:{signal:r}})})}};return i}},79778:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createRealtimeClient=function({config:e}){return{connect(t,i){let c;let{clientOnly:h=(0,l.isReact)()&&!(0,a.isBrowser)(),connectionKey:u=crypto.randomUUID(),maxBuffering:b,throttleInterval:v=128}=i;if(h&&!(0,a.isBrowser)())return m;y.set(u,{onError:i.onError,onResult:i.onResult});let U=()=>y.get(u),E=function(e,t,i){if(!p.has(e)){let r=(0,n.interpret)(d,i);p.set(e,Object.assign(Object.assign({},r),{throttledSend:t>0?(0,l.throttle)(r.send,t,!0):r.send}))}return p.get(e)}(u,v,({context:i,machine:n,send:a})=>{let{enqueuedMessage:h,token:u}=i;if("active"===n.current&&h&&a({type:"send",message:h}),"authRequired"===n.current&&void 0===u&&c!==n.current&&(a({type:"initiateAuth"}),(0,s.getTemporaryAuthToken)(t,e).then(e=>{a({type:"authenticated",token:e}),setTimeout(()=>{a({type:"expireToken"})},Math.round(900*s.TOKEN_EXPIRATION_SECONDS))}).catch(e=>{a({type:"unauthorized",error:e})})),"connecting"===n.current&&c!==n.current&&void 0!==u){let e=new WebSocket(function(e,{token:t,maxBuffering:i}){if(void 0!==i&&(i<1||i>60))throw Error("The `maxBuffering` must be between 1 and 60 (inclusive)");let r=new URLSearchParams({fal_jwt_token:t});void 0!==i&&r.set("max_buffering",i.toFixed(0));let n=(0,l.ensureEndpointIdFormat)(e);return`wss://fal.run/${n}/realtime?${r.toString()}`}(t,{token:u,maxBuffering:b}));e.onopen=()=>{a({type:"connected",websocket:e})},e.onclose=e=>{if(e.code!==f.NORMAL_CLOSURE){let{onError:t=g}=U();t(new o.ApiError({message:`Error closing the connection: ${e.reason}`,status:e.code}))}a({type:"connectionClosed",code:e.code})},e.onerror=e=>{let{onError:t=g}=U();t(new o.ApiError({message:"Unknown error",status:500}))},e.onmessage=e=>{let{onResult:t}=U();if(e.data instanceof ArrayBuffer){t((0,r.decode)(new Uint8Array(e.data)));return}if(e.data instanceof Uint8Array){t((0,r.decode)(e.data));return}if(e.data instanceof Blob){e.data.arrayBuffer().then(e=>{t((0,r.decode)(new Uint8Array(e)))});return}let i=JSON.parse(e.data);if("error"===i.status&&"Unauthorized"===i.error){a({type:"unauthorized",error:Error("Unauthorized")});return}if("error"!==i.status&&"x-fal-message"!==i.type&&!w(i)){t(i);return}if(w(i)){if("TIMEOUT"===i.error)return;let{onError:e=g}=U();e(new o.ApiError({message:`${i.error}: ${i.reason}`,status:400,body:i}));return}}}c=n.current});return{send:e=>{E.throttledSend({type:"send",message:e})},close:()=>{E.send({type:"close"})}}}}};let r=i(80118),n=i(64046),s=i(80093),o=i(66506),a=i(74211),l=i(90665);function c(e,t){return Object.assign(Object.assign({},e),{enqueuedMessage:t.message})}function h(e){return e.websocket&&e.websocket.readyState===WebSocket.OPEN&&e.websocket.close(),Object.assign(Object.assign({},e),{websocket:void 0})}function u(e){return Object.assign(Object.assign({},e),{token:void 0})}let d=(0,n.createMachine)("idle",{idle:(0,n.state)((0,n.transition)("send","connecting",(0,n.reduce)(c)),(0,n.transition)("expireToken","idle",(0,n.reduce)(u)),(0,n.transition)("close","idle",(0,n.reduce)(h))),connecting:(0,n.state)((0,n.transition)("connecting","connecting"),(0,n.transition)("connected","active",(0,n.reduce)(function(e,t){return Object.assign(Object.assign({},e),{websocket:t.websocket})})),(0,n.transition)("connectionClosed","idle",(0,n.reduce)(h)),(0,n.transition)("send","connecting",(0,n.reduce)(c)),(0,n.transition)("close","idle",(0,n.reduce)(h)),(0,n.immediate)("authRequired",(0,n.guard)(function(e){return!(void 0!==e.token)}))),authRequired:(0,n.state)((0,n.transition)("initiateAuth","authInProgress"),(0,n.transition)("send","authRequired",(0,n.reduce)(c)),(0,n.transition)("close","idle",(0,n.reduce)(h))),authInProgress:(0,n.state)((0,n.transition)("authenticated","connecting",(0,n.reduce)(function(e,t){return Object.assign(Object.assign({},e),{token:t.token})})),(0,n.transition)("unauthorized","idle",(0,n.reduce)(u),(0,n.reduce)(h)),(0,n.transition)("send","authInProgress",(0,n.reduce)(c)),(0,n.transition)("close","idle",(0,n.reduce)(h))),active:(0,n.state)((0,n.transition)("send","active",(0,n.reduce)(function(e,t){return e.websocket&&e.websocket.readyState===WebSocket.OPEN?(t.message instanceof Uint8Array?e.websocket.send(t.message):e.websocket.send((0,r.encode)(t.message)),Object.assign(Object.assign({},e),{enqueuedMessage:void 0})):Object.assign(Object.assign({},e),{enqueuedMessage:t.message})})),(0,n.transition)("unauthorized","idle",(0,n.reduce)(u)),(0,n.transition)("connectionClosed","idle",(0,n.reduce)(h)),(0,n.transition)("close","idle",(0,n.reduce)(h))),failed:(0,n.state)((0,n.transition)("send","failed"),(0,n.transition)("close","idle",(0,n.reduce)(h)))},()=>({enqueuedMessage:void 0})),f={NORMAL_CLOSURE:1e3},p=new Map,y=new Map,g=()=>{},m={send:g,close:g};function w(e){return"x-fal-error"===e.type}},89474:function(e,t,i){var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(n,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(o,a)}l((r=r.apply(e,t||[])).next())})},n=this&&this.__rest||function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,r=Object.getOwnPropertySymbols(e);n<r.length;n++)0>t.indexOf(r[n])&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(i[r[n]]=e[r[n]]);return i};Object.defineProperty(t,"__esModule",{value:!0}),t.dispatchRequest=function(e){return r(this,void 0,void 0,function*(){var t;let i;let{targetUrl:c,input:h,config:u,options:d={}}=e,{credentials:f,requestMiddleware:p,responseHandler:y,fetch:g}=u,m=Object.assign(Object.assign({},u.retry),d.retry||{}),w=()=>r(this,void 0,void 0,function*(){var t,i,r;let s=(0,o.isBrowser)()?{}:{"User-Agent":(0,o.getUserAgent)()},a="function"==typeof f?f():f,{method:u,url:m,headers:w}=yield p({method:(null!==(i=null!==(t=e.method)&&void 0!==t?t:d.method)&&void 0!==i?i:"post").toUpperCase(),url:c,headers:e.headers}),b=Object.assign(Object.assign(Object.assign(Object.assign({},a?{Authorization:`Key ${a}`}:{}),{Accept:"application/json","Content-Type":"application/json"}),s),null!=w?w:{}),{responseHandler:v,retry:U}=d,E=n(d,["responseHandler","retry"]),x=yield g(m,Object.assign(Object.assign(Object.assign(Object.assign({},E),{method:u,headers:Object.assign(Object.assign({},b),null!==(r=E.headers)&&void 0!==r?r:{})}),!l&&{mode:"cors"}),{signal:d.signal,body:"get"!==u.toLowerCase()&&h?JSON.stringify(h):void 0}));return yield(null!=v?v:y)(x)});for(let e=0;e<=m.maxRetries;e++)try{return yield w()}catch(n){if(i=n,e===m.maxRetries||!(0,s.isRetryableError)(n,m.retryableStatusCodes)||(null===(t=d.signal)||void 0===t?void 0:t.aborted))throw n;let r=(0,s.calculateBackoffDelay)(e,m.baseDelay,m.maxDelay,m.backoffMultiplier,m.enableJitter);yield(0,a.sleep)(r)}throw i})},t.buildUrl=function(e,t={}){var i,r;let n=(null!==(i=t.method)&&void 0!==i?i:"post").toLowerCase(),s=(null!==(r=t.path)&&void 0!==r?r:"").replace(/^\//,"").replace(/\/{2,}/,"/"),o=t.input,l=Object.assign(Object.assign({},t.query||{}),"get"===n?o:{}),c=Object.keys(l).length>0?`?${new URLSearchParams(l).toString()}`:"";if((0,a.isValidUrl)(e)){let t=e.endsWith("/")?e:`${e}/`;return`${t}${s}${c}`}let h=(0,a.ensureEndpointIdFormat)(e),u=t.subdomain?`${t.subdomain}.`:"",d=`https://${u}fal.run/${h}/${s}`;return`${d.replace(/\/$/,"")}${c}`};let s=i(88131),o=i(74211),a=i(90665),l="undefined"!=typeof navigator&&(null==navigator?void 0:navigator.userAgent)==="Cloudflare-Workers"},66506:function(e,t){var i=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(n,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(o,a)}l((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.ValidationError=t.ApiError=void 0,t.defaultResponseHandler=s,t.resultResponseHandler=function(e){return i(this,void 0,void 0,function*(){return{data:yield s(e),requestId:e.headers.get("x-fal-request-id")||""}})};class r extends Error{constructor({message:e,status:t,body:i}){super(e),this.name="ApiError",this.status=t,this.body=i}}t.ApiError=r;class n extends r{constructor(e){super(e),this.name="ValidationError"}get fieldErrors(){return"string"==typeof this.body.detail?[{loc:["body"],msg:this.body.detail,type:"value_error"}]:this.body.detail||[]}getFieldErrors(e){return this.fieldErrors.filter(t=>t.loc[t.loc.length-1]===e)}}function s(e){return i(this,void 0,void 0,function*(){var t;let{status:i,statusText:s}=e,o=null!==(t=e.headers.get("Content-Type"))&&void 0!==t?t:"";if(!e.ok){if(o.includes("application/json")){let t=yield e.json();throw new(422===i?n:r)({message:t.message||s,status:i,body:t})}throw new r({message:`HTTP ${i}: ${s}`,status:i})}return o.includes("application/json")?e.json():o.includes("text/html")?e.text():o.includes("application/octet-stream")?e.arrayBuffer():e.text()})}t.ValidationError=n},88131:function(e,t,i){var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(n,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(o,a)}l((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_RETRY_OPTIONS=t.DEFAULT_RETRYABLE_STATUS_CODES=void 0,t.isRetryableError=o,t.calculateBackoffDelay=a,t.executeWithRetry=function(e,t,i){return r(this,void 0,void 0,function*(){let r;let n={totalAttempts:0,totalDelay:0};for(let l=0;l<=t.maxRetries;l++){n.totalAttempts++;try{return{result:yield e(),metrics:n}}catch(c){if(r=c,n.lastError=c,l===t.maxRetries||!o(c,t.retryableStatusCodes))throw c;let e=a(l,t.baseDelay,t.maxDelay,t.backoffMultiplier,t.enableJitter);n.totalDelay+=e,i&&i(l+1,c,e),yield(0,s.sleep)(e)}}throw r})};let n=i(66506),s=i(90665);function o(e,t){return e instanceof n.ApiError&&t.includes(e.status)}function a(e,t,i,r,n){let s=Math.min(t*Math.pow(r,e),i);return n?Math.max(0,s+.25*s*(2*Math.random()-1)):s}t.DEFAULT_RETRYABLE_STATUS_CODES=[429,502,503,504],t.DEFAULT_RETRY_OPTIONS={maxRetries:3,baseDelay:1e3,maxDelay:3e4,backoffMultiplier:2,retryableStatusCodes:t.DEFAULT_RETRYABLE_STATUS_CODES,enableJitter:!0}},74211:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isBrowser=function(){return"undefined"!=typeof window&&void 0!==window.document},t.getUserAgent=function(){if(null!==r)return r;let e=i(23399);return r=`${e.name}/${e.version}`};let r=null},36772:function(e,t,i){var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(n,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(o,a)}l((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.createStorageClient=function({config:e}){let t={upload:t=>r(this,void 0,void 0,function*(){if(t.size>94371840)return yield function(e,t){return r(this,void 0,void 0,function*(){let{fetch:i,responseHandler:o}=t,l=e.type||"application/octet-stream",{upload_url:c,file_url:h}=yield function(e,t,i){return r(this,void 0,void 0,function*(){let r=e.name||`${Date.now()}.${a(i)}`;return yield(0,s.dispatchRequest)({method:"POST",targetUrl:`${(0,n.getRestApiUrl)()}/storage/upload/initiate-multipart?storage_type=fal-cdn-v3`,input:{content_type:i,file_name:r},config:t})})}(e,t,l),u=Math.ceil(e.size/10485760),d=new URL(c),f=[];for(let i=0;i<u;i++){let n=10485760*i,s=Math.min(n+10485760,e.size),o=e.slice(n,s),a=i+1,l=`${d.origin}${d.pathname}/${a}${d.search}`;f.push((yield function e(t,i,n){return r(this,arguments,void 0,function*(t,i,r,n=3){if(0===n)throw Error("Part upload failed, retries exhausted");let{fetch:s,responseHandler:o}=r;try{let e=yield s(t,{method:"PUT",body:i});return yield o(e)}catch(s){return yield e(t,i,r,n-1)}})}(l,o,t)))}let p=`${d.origin}${d.pathname}/complete${d.search}`,y=yield i(p,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({parts:f.map(e=>({partNumber:e.partNumber,etag:e.etag}))})});return yield o(y),h})}(t,e);let i=t.type||"application/octet-stream",{fetch:o,responseHandler:l}=e,{upload_url:c,file_url:h}=yield function(e,t,i){return r(this,void 0,void 0,function*(){let r=e.name||`${Date.now()}.${a(i)}`;return yield(0,s.dispatchRequest)({method:"POST",targetUrl:`${(0,n.getRestApiUrl)()}/storage/upload/initiate?storage_type=fal-cdn-v3`,input:{content_type:i,file_name:r},config:t})})}(t,e,i),u=yield o(c,{method:"PUT",body:t,headers:{"Content-Type":t.type||"application/octet-stream"}});return yield l(u),h}),transformInput:e=>r(this,void 0,void 0,function*(){if(Array.isArray(e))return Promise.all(e.map(e=>t.transformInput(e)));if(e instanceof Blob)return yield t.upload(e);if((0,o.isPlainObject)(e)){let i=Object.entries(e).map(e=>r(this,[e],void 0,function*([e,i]){return[e,(yield t.transformInput(i))]}));return Object.fromEntries((yield Promise.all(i)))}return e})};return t};let n=i(61254),s=i(89474),o=i(90665);function a(e){var t;let[i,r]=e.split("/");return null!==(t=r.split(/[-;]/)[0])&&void 0!==t?t:"bin"}},74021:function(e,t,i){var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(n,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(o,a)}l((r=r.apply(e,t||[])).next())})},n=this&&this.__await||function(e){return this instanceof n?(this.v=e,this):new n(e)},s=this&&this.__asyncGenerator||function(e,t,i){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var r,s=i.apply(e,t||[]),o=[];return r={},a("next"),a("throw"),a("return",function(e){return function(t){return Promise.resolve(t).then(e,h)}}),r[Symbol.asyncIterator]=function(){return this},r;function a(e,t){s[e]&&(r[e]=function(t){return new Promise(function(i,r){o.push([e,t,i,r])>1||l(e,t)})},t&&(r[e]=t(r[e])))}function l(e,t){try{var i;(i=s[e](t)).value instanceof n?Promise.resolve(i.value.v).then(c,h):u(o[0][2],i)}catch(e){u(o[0][3],e)}}function c(e){l("next",e)}function h(e){l("throw",e)}function u(e,t){e(t),o.shift(),o.length&&l(o[0][0],o[0][1])}};Object.defineProperty(t,"__esModule",{value:!0}),t.FalStream=void 0,t.createStreamingClient=function({config:e,storage:t}){return{stream(i,n){return r(this,void 0,void 0,function*(){let r=n.input?yield t.transformInput(n.input):void 0;return new u(i,e,Object.assign(Object.assign({},n),{input:r}))})}}};let o=i(56934),a=i(80093),l=i(89474),c=i(66506),h="text/event-stream";class u{constructor(e,t,i){var n;this.listeners=new Map,this.buffer=[],this.currentData=void 0,this.lastEventTimestamp=0,this.streamClosed=!1,this._requestId=null,this.abortController=new AbortController,this.start=()=>r(this,void 0,void 0,function*(){var e,t;let{endpointId:i,options:n}=this,{input:s,method:o="post",connectionMode:c="server"}=n;try{if("client"===c){let t=yield(0,a.getTemporaryAuthToken)(i,this.config),{fetch:r}=this.config,l=new URL(this.url);l.searchParams.set("fal_jwt_token",t);let c=yield r(l.toString(),{method:o.toUpperCase(),headers:{accept:null!==(e=n.accept)&&void 0!==e?e:h,"content-type":"application/json"},body:s&&"get"!==o?JSON.stringify(s):void 0,signal:this.abortController.signal});return this._requestId=c.headers.get("x-fal-request-id"),yield this.handleResponse(c)}return yield(0,l.dispatchRequest)({method:o.toUpperCase(),targetUrl:this.url,input:s,config:this.config,options:{headers:{accept:null!==(t=n.accept)&&void 0!==t?t:h},responseHandler:e=>r(this,void 0,void 0,function*(){return this._requestId=e.headers.get("x-fal-request-id"),yield this.handleResponse(e)}),signal:this.abortController.signal}})}catch(e){this.handleError(e)}}),this.handleResponse=e=>r(this,void 0,void 0,function*(){var t,i;if(!e.ok){try{yield(0,c.defaultResponseHandler)(e)}catch(e){this.emit("error",e)}return}let n=e.body;if(!n){this.emit("error",new c.ApiError({message:"Response body is empty.",status:400,body:void 0}));return}if(!(null!==(t=e.headers.get("content-type"))&&void 0!==t?t:"").startsWith(h)){let e=n.getReader(),t=()=>{e.read().then(({done:e,value:i})=>{if(e){this.emit("done",this.currentData);return}this.currentData=i,this.emit("data",i),t()})};t();return}let s=new TextDecoder("utf-8"),a=e.body.getReader(),l=(0,o.createParser)(e=>{if("event"===e.type){let t=e.data;try{let e=JSON.parse(t);this.buffer.push(e),this.currentData=e,this.emit("data",e),this.emit("message",e)}catch(e){this.emit("error",e)}}}),u=null!==(i=this.options.timeout)&&void 0!==i?i:15e3,d=()=>r(this,void 0,void 0,function*(){let{value:e,done:t}=yield a.read();this.lastEventTimestamp=Date.now(),l.feed(s.decode(e)),Date.now()-this.lastEventTimestamp>u&&this.emit("error",new c.ApiError({message:`Event stream timed out after ${(u/1e3).toFixed(0)} seconds with no messages.`,status:408})),t?this.emit("done",this.currentData):d().catch(this.handleError)});d().catch(this.handleError)}),this.handleError=e=>{var t;if("AbortError"===e.name||this.signal.aborted)return;let i=e instanceof c.ApiError?e:new c.ApiError({message:null!==(t=e.message)&&void 0!==t?t:"An unknown error occurred",status:500});this.emit("error",i)},this.on=(e,t)=>{var i;this.listeners.has(e)||this.listeners.set(e,[]),null===(i=this.listeners.get(e))||void 0===i||i.push(t)},this.emit=(e,t)=>{for(let i of this.listeners.get(e)||[])i(t)},this.done=()=>r(this,void 0,void 0,function*(){return this.donePromise}),this.abort=e=>{this.streamClosed||this.abortController.abort(e)},this.endpointId=e,this.config=t,this.url=null!==(n=i.url)&&void 0!==n?n:(0,l.buildUrl)(e,{path:"/stream",query:i.queryParams}),this.options=i,this.donePromise=new Promise((e,t)=>{this.streamClosed&&t(new c.ApiError({message:"Streaming connection is already closed.",status:400,body:void 0})),this.signal.addEventListener("abort",()=>{var t;e(null!==(t=this.currentData)&&void 0!==t?t:{})}),this.on("done",t=>{this.streamClosed=!0,e(t)}),this.on("error",e=>{this.streamClosed=!0,t(e)})}),i.signal&&i.signal.addEventListener("abort",()=>{this.abortController.abort()}),this.start().catch(this.handleError)}[Symbol.asyncIterator](){return s(this,arguments,function*(){let e=!0,t=()=>e=!1;for(this.on("error",t),this.on("done",t);e||this.buffer.length>0;){let e=this.buffer.shift();e&&(yield yield n(e)),yield n(new Promise(e=>setTimeout(e,16)))}})}get signal(){return this.abortController.signal}get requestId(){return this._requestId}}t.FalStream=u},54539:(e,t)=>{function i(e){return e&&e.status&&e.response_url}Object.defineProperty(t,"__esModule",{value:!0}),t.isQueueStatus=i,t.isCompletedQueueStatus=function(e){return i(e)&&"COMPLETED"===e.status}},90665:function(e,t){let i;var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(n,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(o,a)}l((r=r.apply(e,t||[])).next())})};function n(e){if(e.split("/").length>1)return e;let[,t,i]=/^([0-9]+)-([a-zA-Z0-9-]+)$/.exec(e)||[];if(t&&i)return`${t}/${i}`;throw Error(`Invalid app id: ${e}. Must be in the format <appOwner>/<appId>`)}Object.defineProperty(t,"__esModule",{value:!0}),t.ensureEndpointIdFormat=n,t.parseEndpointId=function(e){let t=n(e).split("/");return s.includes(t[0])?{owner:t[1],alias:t[2],path:t.slice(3).join("/")||void 0,namespace:t[0]}:{owner:t[0],alias:t[1],path:t.slice(2).join("/")||void 0}},t.isValidUrl=function(e){try{let{host:t}=new URL(e);return/(fal\.(ai|run))$/.test(t)}catch(e){return!1}},t.throttle=function(e,t,i=!1){let r,n;return(...s)=>{!n&&i?(e(...s),n=Date.now()):(r&&clearTimeout(r),r=setTimeout(()=>{Date.now()-n>=t&&(e(...s),n=Date.now())},t-(Date.now()-n)))}},t.isReact=function(){if(void 0===i){let e=Error().stack;i=!!e&&(e.includes("node_modules/react-dom/")||e.includes("node_modules/next/"))}return i},t.isPlainObject=function(e){return!!e&&Object.getPrototypeOf(e)===Object.prototype},t.sleep=function(e){return r(this,void 0,void 0,function*(){return new Promise(t=>setTimeout(t,e))})};let s=["workflows","comfy"]},56934:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});let i=[239,187,191];t.createParser=function(e){let t,r,n,s,o,a,l;return c(),{feed:function(c){var h;r=r?r+c:c,t&&(h=r,i.every((e,t)=>h.charCodeAt(t)===e))&&(r=r.slice(i.length)),t=!1;let u=r.length,d=0,f=!1;for(;d<u;){let t;f&&("\n"===r[d]&&++d,f=!1);let i=-1,c=s;for(let e=n;i<0&&e<u;++e)":"===(t=r[e])&&c<0?c=e-d:"\r"===t?(f=!0,i=e-d):"\n"===t&&(i=e-d);if(i<0){n=u-d,s=c;break}n=0,s=-1,function(t,i,r,n){if(0===n){l.length>0&&(e({type:"event",id:o,event:a||void 0,data:l.slice(0,-1)}),l="",o=void 0),a=void 0;return}let s=r<0,c=t.slice(i,i+(s?n:r)),h=0;h=s?n:" "===t[i+r+1]?r+2:r+1;let u=i+h,d=n-h,f=t.slice(u,u+d).toString();if("data"===c)l+=f?"".concat(f,"\n"):"\n";else if("event"===c)a=f;else if("id"!==c||f.includes("\0")){if("retry"===c){let t=parseInt(f,10);Number.isNaN(t)||e({type:"reconnect-interval",value:t})}}else o=f}(r,d,c,i),d+=i+1}d===u?r="":d>0&&(r=r.slice(d))},reset:c};function c(){t=!0,r="",n=0,s=-1,o=void 0,a=void 0,l=""}}},80118:(e,t,i)=>{i.r(t),i.d(t,{DecodeError:()=>a,Decoder:()=>B,EXT_TIMESTAMP:()=>h,Encoder:()=>b,ExtData:()=>o,ExtensionCodec:()=>m,decode:()=>R,decodeArrayStream:()=>$,decodeAsync:()=>M,decodeMulti:()=>C,decodeMultiStream:()=>L,decodeTimestampExtension:()=>y,decodeTimestampToTimeSpec:()=>p,encode:()=>v,encodeDateToTimeSpec:()=>d,encodeTimeSpecToTimestamp:()=>u,encodeTimestampExtension:()=>f});let r=new TextEncoder;function n(e,t,i){let r=t,n=r+i,s=[],o="";for(;r<n;){let t=e[r++];if((128&t)==0)s.push(t);else if((224&t)==192){let i=63&e[r++];s.push((31&t)<<6|i)}else if((240&t)==224){let i=63&e[r++],n=63&e[r++];s.push((31&t)<<12|i<<6|n)}else if((248&t)==240){let i=(7&t)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++];i>65535&&(i-=65536,s.push(i>>>10&1023|55296),i=56320|1023&i),s.push(i)}else s.push(t);s.length>=4096&&(o+=String.fromCharCode(...s),s.length=0)}return s.length>0&&(o+=String.fromCharCode(...s)),o}let s=new TextDecoder;class o{constructor(e,t){this.type=e,this.data=t}}class a extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Object.create(a.prototype)),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:a.name})}}function l(e,t,i){e.setUint32(t,Math.floor(i/4294967296)),e.setUint32(t+4,i)}function c(e,t){return 4294967296*e.getInt32(t)+e.getUint32(t+4)}let h=-1;function u({sec:e,nsec:t}){if(e>=0&&t>=0&&e<=17179869183){if(0===t&&e<=4294967295){let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e),t}{let i=e/4294967296,r=new Uint8Array(8),n=new DataView(r.buffer);return n.setUint32(0,t<<2|3&i),n.setUint32(4,4294967295&e),r}}{let i=new Uint8Array(12),r=new DataView(i.buffer);return r.setUint32(0,t),l(r,4,e),i}}function d(e){let t=e.getTime(),i=Math.floor(t/1e3),r=(t-1e3*i)*1e6,n=Math.floor(r/1e9);return{sec:i+n,nsec:r-1e9*n}}function f(e){return e instanceof Date?u(d(e)):null}function p(e){let t=new DataView(e.buffer,e.byteOffset,e.byteLength);switch(e.byteLength){case 4:return{sec:t.getUint32(0),nsec:0};case 8:{let e=t.getUint32(0);return{sec:(3&e)*4294967296+t.getUint32(4),nsec:e>>>2}}case 12:return{sec:c(t,4),nsec:t.getUint32(0)};default:throw new a(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${e.length}`)}}function y(e){let t=p(e);return new Date(1e3*t.sec+t.nsec/1e6)}let g={type:-1,encode:f,decode:y};class m{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(g)}register({type:e,encode:t,decode:i}){if(e>=0)this.encoders[e]=t,this.decoders[e]=i;else{let r=-1-e;this.builtInEncoders[r]=t,this.builtInDecoders[r]=i}}tryToEncode(e,t){for(let i=0;i<this.builtInEncoders.length;i++){let r=this.builtInEncoders[i];if(null!=r){let n=r(e,t);if(null!=n)return new o(-1-i,n)}}for(let i=0;i<this.encoders.length;i++){let r=this.encoders[i];if(null!=r){let n=r(e,t);if(null!=n)return new o(i,n)}}return e instanceof o?e:null}decode(e,t,i){let r=t<0?this.builtInDecoders[-1-t]:this.decoders[t];return r?r(e,t,i):new o(t,e)}}function w(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e instanceof ArrayBuffer||"undefined"!=typeof SharedArrayBuffer&&e instanceof SharedArrayBuffer?new Uint8Array(e):Uint8Array.from(e)}m.defaultCodec=new m;class b{constructor(e){this.entered=!1,this.extensionCodec=e?.extensionCodec??m.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.maxDepth=e?.maxDepth??100,this.initialBufferSize=e?.initialBufferSize??2048,this.sortKeys=e?.sortKeys??!1,this.forceFloat32=e?.forceFloat32??!1,this.ignoreUndefined=e?.ignoreUndefined??!1,this.forceIntegerToFloat=e?.forceIntegerToFloat??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new b({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,t){if(t>this.maxDepth)throw Error(`Too deep objects in depth ${t}`);null==e?this.encodeNil():"boolean"==typeof e?this.encodeBoolean(e):"number"==typeof e?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):"string"==typeof e?this.encodeString(e):this.useBigInt64&&"bigint"==typeof e?this.encodeBigInt64(e):this.encodeObject(e,t)}ensureBufferSizeToWrite(e){let t=this.pos+e;this.view.byteLength<t&&this.resizeBuffer(2*t)}resizeBuffer(e){let t=new ArrayBuffer(e),i=new Uint8Array(t),r=new DataView(t);i.set(this.bytes),this.view=r,this.bytes=i}encodeNil(){this.writeU8(192)}encodeBoolean(e){!1===e?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){var t,i,n;let s=function(e){let t=e.length,i=0,r=0;for(;r<t;){let n=e.charCodeAt(r++);if((4294967168&n)==0){i++;continue}if((4294965248&n)==0)i+=2;else{if(n>=55296&&n<=56319&&r<t){let t=e.charCodeAt(r);(64512&t)==56320&&(++r,n=((1023&n)<<10)+(1023&t)+65536)}(4294901760&n)==0?i+=3:i+=4}}return i}(e);this.ensureBufferSizeToWrite(5+s),this.writeStringHeader(s),t=e,i=this.bytes,n=this.pos,t.length>50?r.encodeInto(t,i.subarray(n)):function(e,t,i){let r=e.length,n=i,s=0;for(;s<r;){let i=e.charCodeAt(s++);if((4294967168&i)==0){t[n++]=i;continue}if((4294965248&i)==0)t[n++]=i>>6&31|192;else{if(i>=55296&&i<=56319&&s<r){let t=e.charCodeAt(s);(64512&t)==56320&&(++s,i=((1023&i)<<10)+(1023&t)+65536)}(4294901760&i)==0?t[n++]=i>>12&15|224:(t[n++]=i>>18&7|240,t[n++]=i>>12&63|128),t[n++]=i>>6&63|128}t[n++]=63&i|128}}(t,i,n),this.pos+=s}encodeObject(e,t){let i=this.extensionCodec.tryToEncode(e,this.context);if(null!=i)this.encodeExtension(i);else if(Array.isArray(e))this.encodeArray(e,t);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if("object"==typeof e)this.encodeMap(e,t);else throw Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){let t=e.byteLength;if(t<256)this.writeU8(196),this.writeU8(t);else if(t<65536)this.writeU8(197),this.writeU16(t);else if(t<4294967296)this.writeU8(198),this.writeU32(t);else throw Error(`Too large binary: ${t}`);let i=w(e);this.writeU8a(i)}encodeArray(e,t){let i=e.length;if(i<16)this.writeU8(144+i);else if(i<65536)this.writeU8(220),this.writeU16(i);else if(i<4294967296)this.writeU8(221),this.writeU32(i);else throw Error(`Too large array: ${i}`);for(let i of e)this.doEncode(i,t+1)}countWithoutUndefined(e,t){let i=0;for(let r of t)void 0!==e[r]&&i++;return i}encodeMap(e,t){let i=Object.keys(e);this.sortKeys&&i.sort();let r=this.ignoreUndefined?this.countWithoutUndefined(e,i):i.length;if(r<16)this.writeU8(128+r);else if(r<65536)this.writeU8(222),this.writeU16(r);else if(r<4294967296)this.writeU8(223),this.writeU32(r);else throw Error(`Too large map object: ${r}`);for(let r of i){let i=e[r];this.ignoreUndefined&&void 0===i||(this.encodeString(r),this.doEncode(i,t+1))}}encodeExtension(e){if("function"==typeof e.data){let t=e.data(this.pos+6),i=t.length;if(i>=4294967296)throw Error(`Too large extension object: ${i}`);this.writeU8(201),this.writeU32(i),this.writeI8(e.type),this.writeU8a(t);return}let t=e.data.length;if(1===t)this.writeU8(212);else if(2===t)this.writeU8(213);else if(4===t)this.writeU8(214);else if(8===t)this.writeU8(215);else if(16===t)this.writeU8(216);else if(t<256)this.writeU8(199),this.writeU8(t);else if(t<65536)this.writeU8(200),this.writeU16(t);else if(t<4294967296)this.writeU8(201),this.writeU32(t);else throw Error(`Too large extension object: ${t}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){let t=e.length;this.ensureBufferSizeToWrite(t),this.bytes.set(e,this.pos),this.pos+=t}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){var t,i;this.ensureBufferSizeToWrite(8),t=this.view,i=this.pos,t.setUint32(i,e/4294967296),t.setUint32(i+4,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),l(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}}function v(e,t){return new b(t).encodeSharedRef(e)}function U(e){return`${e<0?"-":""}0x${Math.abs(e).toString(16).padStart(2,"0")}`}class E{constructor(e=16,t=16){this.hit=0,this.miss=0,this.maxKeyLength=e,this.maxLengthPerKey=t,this.caches=[];for(let e=0;e<this.maxKeyLength;e++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,t,i){let r=this.caches[i-1];e:for(let n of r){let r=n.bytes;for(let n=0;n<i;n++)if(r[n]!==e[t+n])continue e;return n.str}return null}store(e,t){let i=this.caches[e.length-1],r={bytes:e,str:t};i.length>=this.maxLengthPerKey?i[Math.random()*i.length|0]=r:i.push(r)}decode(e,t,i){let r=this.find(e,t,i);if(null!=r)return this.hit++,r;this.miss++;let s=n(e,t,i),o=Uint8Array.prototype.slice.call(e,t,t+i);return this.store(o,s),s}}let x="array",S="map_key",O="map_value",_=e=>{if("string"==typeof e||"number"==typeof e)return e;throw new a("The type of key must be string or number but "+typeof e)};class A{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){let t=this.getUninitializedStateFromPool();t.type=x,t.position=0,t.size=e,t.array=Array(e)}pushMapState(e){let t=this.getUninitializedStateFromPool();t.type=S,t.readCount=0,t.size=e,t.map={}}getUninitializedStateFromPool(){return this.stackHeadPosition++,this.stackHeadPosition===this.stack.length&&this.stack.push({type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null}),this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw Error("Invalid stack state. Released state is not on top of the stack.");e.type===x&&(e.size=0,e.array=void 0,e.position=0,e.type=void 0),(e.type===S||e.type===O)&&(e.size=0,e.map=void 0,e.readCount=0,e.type=void 0),this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}let T=new DataView(new ArrayBuffer(0)),I=new Uint8Array(T.buffer);try{T.getInt8(0)}catch(e){if(!(e instanceof RangeError))throw Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}let j=RangeError("Insufficient data"),P=new E;class B{constructor(e){this.totalPos=0,this.pos=0,this.view=T,this.bytes=I,this.headByte=-1,this.stack=new A,this.entered=!1,this.extensionCodec=e?.extensionCodec??m.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.rawStrings=e?.rawStrings??!1,this.maxStrLength=e?.maxStrLength??4294967295,this.maxBinLength=e?.maxBinLength??4294967295,this.maxArrayLength=e?.maxArrayLength??4294967295,this.maxMapLength=e?.maxMapLength??4294967295,this.maxExtLength=e?.maxExtLength??4294967295,this.keyDecoder=e?.keyDecoder!==void 0?e.keyDecoder:P,this.mapKeyConverter=e?.mapKeyConverter??_}clone(){return new B({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=-1,this.stack.reset()}setBuffer(e){let t=w(e);this.bytes=t,this.view=new DataView(t.buffer,t.byteOffset,t.byteLength),this.pos=0}appendBuffer(e){if(-1!==this.headByte||this.hasRemaining(1)){let t=this.bytes.subarray(this.pos),i=w(e),r=new Uint8Array(t.length+i.length);r.set(t),r.set(i,t.length),this.setBuffer(r)}else this.setBuffer(e)}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){let{view:t,pos:i}=this;return RangeError(`Extra ${t.byteLength-i} of ${t.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);let t=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return t}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){let t=this.clone();yield*t.decodeMulti(e);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered)return this.clone().decodeAsync(e);try{let t;this.entered=!0;let i=!1;for await(let r of e){if(i)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(r);try{t=this.doDecodeSync(),i=!0}catch(e){if(!(e instanceof RangeError))throw e}this.totalPos+=this.pos}if(i){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return t}let{headByte:r,pos:n,totalPos:s}=this;throw RangeError(`Insufficient data in parsing ${U(r)} at ${s} (${n} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async *decodeMultiAsync(e,t){if(this.entered){let i=this.clone();yield*i.decodeMultiAsync(e,t);return}try{this.entered=!0;let i=t,r=-1;for await(let n of e){if(t&&0===r)throw this.createExtraByteError(this.totalPos);this.appendBuffer(n),i&&(r=this.readArraySize(),i=!1,this.complete());try{for(;yield this.doDecodeSync(),0!=--r;);}catch(e){if(!(e instanceof RangeError))throw e}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){t:for(;;){let e;let t=this.readHeadByte();if(t>=224)e=t-256;else if(t<192){if(t<128)e=t;else if(t<144){let i=t-128;if(0!==i){this.pushMapState(i),this.complete();continue}e={}}else if(t<160){let i=t-144;if(0!==i){this.pushArrayState(i),this.complete();continue}e=[]}else{let i=t-160;e=this.decodeString(i,0)}}else if(192===t)e=null;else if(194===t)e=!1;else if(195===t)e=!0;else if(202===t)e=this.readF32();else if(203===t)e=this.readF64();else if(204===t)e=this.readU8();else if(205===t)e=this.readU16();else if(206===t)e=this.readU32();else if(207===t)e=this.useBigInt64?this.readU64AsBigInt():this.readU64();else if(208===t)e=this.readI8();else if(209===t)e=this.readI16();else if(210===t)e=this.readI32();else if(211===t)e=this.useBigInt64?this.readI64AsBigInt():this.readI64();else if(217===t){let t=this.lookU8();e=this.decodeString(t,1)}else if(218===t){let t=this.lookU16();e=this.decodeString(t,2)}else if(219===t){let t=this.lookU32();e=this.decodeString(t,4)}else if(220===t){let t=this.readU16();if(0!==t){this.pushArrayState(t),this.complete();continue}e=[]}else if(221===t){let t=this.readU32();if(0!==t){this.pushArrayState(t),this.complete();continue}e=[]}else if(222===t){let t=this.readU16();if(0!==t){this.pushMapState(t),this.complete();continue}e={}}else if(223===t){let t=this.readU32();if(0!==t){this.pushMapState(t),this.complete();continue}e={}}else if(196===t){let t=this.lookU8();e=this.decodeBinary(t,1)}else if(197===t){let t=this.lookU16();e=this.decodeBinary(t,2)}else if(198===t){let t=this.lookU32();e=this.decodeBinary(t,4)}else if(212===t)e=this.decodeExtension(1,0);else if(213===t)e=this.decodeExtension(2,0);else if(214===t)e=this.decodeExtension(4,0);else if(215===t)e=this.decodeExtension(8,0);else if(216===t)e=this.decodeExtension(16,0);else if(199===t){let t=this.lookU8();e=this.decodeExtension(t,1)}else if(200===t){let t=this.lookU16();e=this.decodeExtension(t,2)}else if(201===t){let t=this.lookU32();e=this.decodeExtension(t,4)}else throw new a(`Unrecognized type byte: ${U(t)}`);this.complete();let i=this.stack;for(;i.length>0;){let t=i.top();if(t.type===x){if(t.array[t.position]=e,t.position++,t.position===t.size)e=t.array,i.release(t);else continue t}else if(t.type===S){if("__proto__"===e)throw new a("The key __proto__ is not allowed");t.key=this.mapKeyConverter(e),t.type=O;continue t}else if(t.map[t.key]=e,t.readCount++,t.readCount===t.size)e=t.map,i.release(t);else{t.key=null,t.type=S;continue t}}return e}}readHeadByte(){return -1===this.headByte&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=-1}readArraySize(){let e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:if(e<160)return e-144;throw new a(`Unrecognized array type byte: ${U(e)}`)}}pushMapState(e){if(e>this.maxMapLength)throw new a(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new a(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,t){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,t):this.decodeBinary(e,t)}decodeUtf8String(e,t){let i;if(e>this.maxStrLength)throw new a(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+t+e)throw j;let r=this.pos+t;if(this.stateIsMapKey()&&this.keyDecoder?.canBeCached(e))i=this.keyDecoder.decode(this.bytes,r,e);else{var o;o=this.bytes,i=e>200?function(e,t,i){let r=e.subarray(t,t+i);return s.decode(r)}(o,r,e):n(o,r,e)}return this.pos+=t+e,i}stateIsMapKey(){return this.stack.length>0&&this.stack.top().type===S}decodeBinary(e,t){if(e>this.maxBinLength)throw new a(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+t))throw j;let i=this.pos+t,r=this.bytes.subarray(i,i+e);return this.pos+=t+e,r}decodeExtension(e,t){if(e>this.maxExtLength)throw new a(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);let i=this.view.getInt8(this.pos+t),r=this.decodeBinary(e,t+1);return this.extensionCodec.decode(r,i,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){let e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){let e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){let e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){let e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){let e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){let e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){var e,t;let i=(e=this.view,t=this.pos,4294967296*e.getUint32(t)+e.getUint32(t+4));return this.pos+=8,i}readI64(){let e=c(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){let e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){let e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){let e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){let e=this.view.getFloat64(this.pos);return this.pos+=8,e}}function R(e,t){return new B(t).decode(e)}function C(e,t){return new B(t).decodeMulti(e)}async function*k(e){let t=e.getReader();try{for(;;){let{done:e,value:i}=await t.read();if(e)return;yield i}}finally{t.releaseLock()}}function D(e){return null!=e[Symbol.asyncIterator]?e:k(e)}async function M(e,t){let i=D(e);return new B(t).decodeAsync(i)}function $(e,t){let i=D(e);return new B(t).decodeArrayStream(i)}function L(e,t){let i=D(e);return new B(t).decodeStream(i)}},23399:e=>{e.exports=JSON.parse('{"name":"@fal-ai/client","description":"The fal.ai client for JavaScript and TypeScript","version":"1.7.0","license":"MIT","repository":{"type":"git","url":"https://github.com/fal-ai/fal-js.git","directory":"libs/client"},"keywords":["fal","client","ai","ml","typescript"],"exports":{".":"./src/index.js","./endpoints":"./src/types/endpoints.js"},"typesVersions":{"*":{"endpoints":["src/types/endpoints.d.ts"]}},"main":"./src/index.js","types":"./src/index.d.ts","dependencies":{"@msgpack/msgpack":"^3.0.0-beta2","eventsource-parser":"^1.1.2","robot3":"^0.4.1"},"engines":{"node":">=18.0.0"},"type":"commonjs"}')}};